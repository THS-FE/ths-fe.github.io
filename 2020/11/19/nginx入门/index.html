<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Nginx入门 - 思路大前端团队</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#f7f7f7"><meta name="application-name" content="思路大前端"><meta name="msapplication-TileImage" content="/img/favicon.ico"><meta name="msapplication-TileColor" content="#f7f7f7"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="思路大前端"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta description="Nginx入门以及前端需要掌握的一些简单配置"><meta property="og:type" content="blog"><meta property="og:title" content="Nginx入门"><meta property="og:url" content="https://ths-fe.github.io/2020/11/19/nginx%E5%85%A5%E9%97%A8/"><meta property="og:site_name" content="思路大前端团队"><meta property="og:description" content="Nginx入门以及前端需要掌握的一些简单配置"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://ths-fe.github.io/2020/11/19/nginx%E5%85%A5%E9%97%A8/cover.jpg"><meta property="article:published_time" content="2020-11-19T06:55:45.000Z"><meta property="article:modified_time" content="2020-11-19T06:55:45.000Z"><meta property="article:author" content="恋上南山"><meta property="article:tag" content="中间件"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/2020/11/19/nginx%E5%85%A5%E9%97%A8/cover.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://ths-fe.github.io/2020/11/19/nginx%E5%85%A5%E9%97%A8/"},"headline":"思路大前端团队","image":["https://ths-fe.github.io/2020/11/19/nginx%E5%85%A5%E9%97%A8/cover.jpg"],"datePublished":"2020-11-19T06:55:45.000Z","dateModified":"2020-11-19T06:55:45.000Z","author":{"@type":"Person","name":"恋上南山"},"description":"Nginx入门以及前端需要掌握的一些简单配置"}</script><link rel="canonical" href="https://ths-fe.github.io/2020/11/19/nginx%E5%85%A5%E9%97%A8/"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.13.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/monokai.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?fd8cc3421abec7b8f4e6bc337e25c7d1";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-72716512-3" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-72716512-3');</script><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><script data-ad-client="ca-pub-6826040978803389" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><meta name="generator" content="Hexo 5.2.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/ths.png" alt="思路大前端团队" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">博客</a><a class="navbar-item" href="/fe">大前端技术体系</a><a class="navbar-item" href="/gis">GIS技术体系</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/about">关于我们</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/2020/11/19/nginx%E5%85%A5%E9%97%A8/cover.jpg" alt="Nginx入门"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-11-19T06:55:45.000Z" title="2020-11-19T06:55:45.000Z">2020-11-19</time>发表</span><span class="level-item"><time dateTime="2020-11-19T06:55:45.000Z" title="2020-11-19T06:55:45.000Z">2020-11-19</time>更新</span><span class="level-item"> 恋上南山 </span><span class="level-item">23 分钟读完 (大约3401个字)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">Nginx入门</h1><div class="content"><h1 id="概念（背景、F5）"><a href="#概念（背景、F5）" class="headerlink" title="概念（背景、F5）"></a>概念（<a href="nginx.com/blog/nginx-is-now-officially-part-of-f5/">背景</a>、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/F5/7612514">F5</a>）</h1><p> Nginx (engine x)  是一款轻量级的 <a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000010932798">Web 服务器</a>/反向代理服务器及<a target="_blank" rel="noopener" href="https://www.cnblogs.com/shangdawei/p/4305989.html">电子邮件（IMAP/POP3）代理服务器</a>，其特点是占有内存少，并发能力强。该软件由伊戈尔·赛索耶夫创<br> 建并于2004年首次公开发布。2011年成立同名公司以提供支持。2019年3月11日，Nginx 公司被F5 Networks以6.7亿美元收购。<a target="_blank" rel="noopener" href="https://nginx.org/en/download.html?_ga=2.112794051.635619024.1572431809-1076897348.1572431809">下载地址</a></p>
<h1 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/nginx/nginx-d1aw28wa.html">配置文件</a></h1><p>配置文件 nginx.conf 中文详解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">Nginx 进程数，建议设置为等于CPU总核心数。</span><br><span class="line">worker_processes 8;</span><br><span class="line">全局错误日志定义类型，[ debug | info | notice | warn | error | crit ]</span><br><span class="line">error_log &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;logs&#x2F;error.log info;</span><br><span class="line">进程pid文件</span><br><span class="line">pid &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;logs&#x2F;nginx.pid;</span><br><span class="line"></span><br><span class="line">events</span><br><span class="line">&#123;</span><br><span class="line">    #单个进程最大连接数（最大连接数&#x3D;连接数*进程数）</span><br><span class="line">    #根据硬件调整，和前面工作进程配合起来用，尽量大，但是别把cpu跑到100%就行。每个进程允许的最多连接数，理论上每台Nginx服务器的最大连接数为。</span><br><span class="line">    worker_connections 1024;</span><br><span class="line"></span><br><span class="line">    #keepalive超时时间，单位秒。</span><br><span class="line">    keepalive_timeout 60;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">设定http服务器，利用它的反向代理功能提供负载均衡支持</span><br><span class="line">http</span><br><span class="line">&#123;</span><br><span class="line">    #文件扩展名与文件类型映射表    补充</span><br><span class="line">    include mime.types;</span><br><span class="line"></span><br><span class="line">    #默认文件类型</span><br><span class="line">    default_type application&#x2F;octet-stream;</span><br><span class="line"></span><br><span class="line">    #默认编码</span><br><span class="line">    #charset utf-8;</span><br><span class="line"></span><br><span class="line">    #长连接超时时间，单位是秒</span><br><span class="line">    keepalive_timeout 120;</span><br><span class="line"></span><br><span class="line">    #gzip模块设置  （可以配置http,server和location模块下）</span><br><span class="line">    gzip on; #开启gzip压缩输出</span><br><span class="line">    gzip_min_length 1k;    #最小压缩文件大小</span><br><span class="line">    gzip_buffers 4 16k;    #压缩缓冲区</span><br><span class="line">    gzip_http_version 1.0;    #识别http协议的版本,早起浏览器可能不支持gzip自解压,用  户会看到乱码（默认1.1，前端如果是squid2.5请使用1.0）</span><br><span class="line">    gzip_comp_level 5;    #gzip压缩比（1~9），越小压缩效果越差，但是越大处理越慢，所以一般取中间值;</span><br><span class="line">    gzip_types text&#x2F;plain application&#x2F;x-javascript text&#x2F;css application&#x2F;xml application&#x2F;json;    #压缩类型，默认就已经包含&#39;text&#x2F;html&#39;，所以下面就不用再写了，写上去也不会有问题，但是会有一个warn。</span><br><span class="line">    gzip_vary on;           #启用应答头&quot;Vary: Accept-Encoding&quot;</span><br><span class="line">    gzip_disable &quot;MSIE [1-6]\.&quot;;    #ie6以下就不启用gzip</span><br><span class="line">    gzip_proxied off;             #Nginx做为反向代理时启用,</span><br><span class="line">    off(关闭所有代理结果的数据的压缩),</span><br><span class="line">    expired(启用压缩,如果header头中包括&quot;Expires&quot;头信息),</span><br><span class="line">    no-cache(启用压缩,header头中包含&quot;Cache-Control:no-cache&quot;),</span><br><span class="line">    no-store(启用压缩,header头中包含&quot;Cache-Control:no-store&quot;),</span><br><span class="line">    private(启用压缩,header头中包含&quot;Cache-Control:private&quot;),</span><br><span class="line">    no_last_modefied(启用压缩,header头中不包含&quot;Last-Modified&quot;),</span><br><span class="line">    no_etag(启用压缩,如果header头中不包含&quot;Etag&quot;头信息),</span><br><span class="line">    auth(启用压缩,如果header头中包含&quot;Authorization&quot;头信息)</span><br><span class="line">    any - 无条件启用压缩</span><br><span class="line"></span><br><span class="line">    #虚拟主机的配置</span><br><span class="line">    server</span><br><span class="line">    &#123;</span><br><span class="line">        #监听端口</span><br><span class="line">        listen 80;</span><br><span class="line"></span><br><span class="line">        #域名可以有多个，用空格隔开</span><br><span class="line">        server_name www.w3cschool.cn w3cschool.cn;</span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #图片缓存时间设置</span><br><span class="line">        location ~ .*.(gif|jpg|jpeg|png|bmp|swf)$</span><br><span class="line">        &#123;</span><br><span class="line">            expires 10d;</span><br><span class="line">        &#125;</span><br><span class="line">        #JS和CSS缓存时间设置</span><br><span class="line">        location ~ .*.(js|css)?$</span><br><span class="line">        &#123;</span><br><span class="line">            expires 1h;</span><br><span class="line">        &#125;</span><br><span class="line">  </span><br><span class="line">        #对 &quot;&#x2F;&quot; 启用反向代理</span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">            proxy_pass http:&#x2F;&#x2F;127.0.0.1:88;</span><br><span class="line">            expires  1h;</span><br><span class="line">           #跨域资源共享 CORS</span><br><span class="line"></span><br><span class="line">           add_header &#39;Access-Control-Allow-Origin&#39; &#39;*&#39;; #允许来自所有的访问地址</span><br><span class="line">           add_header &#39;Access-Control-Allow-Credentials&#39; &#39;true&#39;;</span><br><span class="line">           add_header &#39;Access-Control-Allow-Methods&#39; &#39;GET, PUT, POST, DELETE,  OPTIONS&#39;; #支持请求方式</span><br><span class="line">           add_header &#39;Access-Control-Allow-Headers&#39; &#39;Content-Type,*&#39;;     #表明服务器支持的所有头信息字段</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">start nginx            启动Nginx 或者双击文件夹下的nginx.exe</span><br><span class="line"> nginx -s quit         优雅停止Nginx，有连接时会等连接请求完成再杀死worker进程  </span><br><span class="line"> nginx -s reload      优雅重启，并重新载入配置文件nginx.conf</span><br><span class="line"> nginx -s reopen     重新打开日志文件，一般用于切割日志</span><br><span class="line"> nginx -v        查看版本  </span><br><span class="line"> nginx -t        检查Nginx的配置文件</span><br><span class="line"> nginx -h       查看帮助信息</span><br><span class="line">nginx -V       详细版本信息，包括编译参数</span><br><span class="line"> nginx  -c filename  指定配置文件</span><br></pre></td></tr></table></figure>

<h1 id="功能（前端开发需要掌握）"><a href="#功能（前端开发需要掌握）" class="headerlink" title="功能（前端开发需要掌握）"></a>功能（前端开发需要掌握）</h1><h2 id="静态资源发布"><a href="#静态资源发布" class="headerlink" title="静态资源发布"></a>静态资源发布</h2><ol>
<li>使用场景<br>发布前端的静态工程、或者发布静态资源。</li>
<li>优、缺点</li>
<li>根目录配置</li>
</ol>
<img src="/2020/11/19/nginx%E5%85%A5%E9%97%A8/0.jpg" class="">

<p>在红框选择的地方指定 Nginx 的根目录即可。</p>
<h2 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h2><ol>
<li>使用场景<br>做外网映射；请求资源时，由于浏览器的同源策略导致的<a target="_blank" rel="noopener" href="https://ths.js.org/categories/%E5%AE%89%E5%85%A8/%E8%B7%A8%E5%9F%9F/">跨域</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000013267839">配置location</a></li>
</ol>
<h2 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h2><p>负载均衡，英文名称为 Load Balance，是一种技术，指通过某种算法实现负载分担的方法。通俗的讲就是统一分配请求的设备，负载均衡会统一接收全部请求，然后按照设定好的算法将这些请求分配给这个负载均衡组中的所有成员，以此来实现请求（负载）的均衡分配。</p>
<p>举个栗子：用电梯举例，假如从 1 楼到 24 楼吧，假如只有一部电梯，在早上上班高峰时期，10 个人以内没啥问题，但是同时来 50 个人呢，就会有很大压力，就需要等待。但是现在有5部电梯同时工作呢，是不是就可以很有效的缓解压力。负载均衡也就是这个道理，通过集群来完成本应该在一台服务器完成的工作。</p>
<h3 id="upstream指令"><a href="#upstream指令" class="headerlink" title="upstream指令"></a>upstream指令</h3><p>upstream 指令用于定义服务器集群</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server backend1.example.com  weight&#x3D;5;</span><br><span class="line">    server 127.0.0.1:8080       max_fails&#x3D;3 #最大次数 fail_timeout&#x3D;30s; #延时30s</span><br><span class="line">    server unix:&#x2F;tmp&#x2F;backend3;</span><br><span class="line">    server backup1.example.com  backup;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="分配方式"><a href="#分配方式" class="headerlink" title="分配方式"></a>分配方式</h3><p>Nginx的 upstream 支持5种 分配方式，其中 轮询、权重、IP散列这三种为Nginx原生支持的分配方式，fair 和 url_hash 为第三方支持的分配方式。<br>1、轮询<br>轮询是upstream的默认分配方式，即每个请求按照时间顺序轮流分配到不同的后端服务器，如果某个后端服务器 down 掉后，能自动剔除。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream zhang21（名称）&#123;</span><br><span class="line">    server 192.168.1.11：8888；</span><br><span class="line">    server 192.168.1.22：8888；</span><br><span class="line">    server 192.168.1.33：8888；</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、weight（权重）<br>轮询的加强版，既可以指定轮询比率，weight 和访问几率成正比，主要应用于后端服务器异质的场景下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream zhang21 &#123;</span><br><span class="line">    server 192.168.1.11 weight&#x3D;1；</span><br><span class="line">    server 192.168.1.22 weight&#x3D;2；</span><br><span class="line">    server 192.168.1.33 weight&#x3D;3；</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、ip_hash<br>每个请求按照访问 Ip（即Nginx的前置服务器或客户端IP）的 hash 结果分配，这样每个访客会固定访问一个后端服务器，可以解决 session 一致问题。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream zhang21 &#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    server 192.168.1.11:7777;</span><br><span class="line">    server 192.168.1.22:8888;</span><br><span class="line">    server 192.168.1.33:9999;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、fair<br>fair顾名思义，公平地按照后端服务器的响应时间（rt）来分配请求，响应时间（rt）小的后端服务器优先分配请求。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream zhang21 &#123;</span><br><span class="line">    server 192.168.1.11;</span><br><span class="line">    server 192.168.1.22;</span><br><span class="line">    server 192.168.1.33;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5、url_hash<br>与 ip_hash 类似，但是按照访问 url 的 hash 结果来分配请求，使得每个 url 定向到同一个后端服务器，主要应用于后端服务器为缓存的场景下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">upstream zhang21 &#123;</span><br><span class="line">   server 192.168.1.11;</span><br><span class="line">   server 192.168.1.22;</span><br><span class="line">   server 192.168.1.33;</span><br><span class="line">   hash $request_uri；</span><br><span class="line">   hash_method crc32；</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中，hash_method 为使用的hash算法，需要注意，此时 server 语句中不能添加 weight 等参数。</p>
<h2 id="动静分离"><a href="#动静分离" class="headerlink" title="动静分离"></a>动静分离</h2><p>服务端接收来自客户端的请求中，有一部分是静态资源的请求，例如 html, css, js 和图片资源等等，有一部分是动态数据的请求。因为tomcat处理静态资源的速度比较慢，所以我们可以考虑把所有静态资源独立开来，交给处理静态资源更快的服务器例如 Nginx 处理，而把动态请求交给tomcat处理。</p>
<p>如下图所示，我们在机器上同时安装了 Nginx 和 tomcat,把所有的静态资源都放置在 Nginx 的 webroot 目录下面，把动态请求的程序都放在 tomcat 的 webroot 目录下面，当客户端访问服务端的时候，如果是静态资源的请求，就直接到 Nginx 的 webroot 目录下面获取资源，如果是动态资源的请求，Nginx 利用反向代理的原理，把请求转发给 tomcat 进行处理，这样就实现了动静分离，提高了服务器处理请求的性能。</p>
<img src="/2020/11/19/nginx%E5%85%A5%E9%97%A8/1.jpg" class="">

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">location ~ .*.jsp$ #所有jsp的页面均交由tomcat处理</span><br><span class="line">&#123;</span><br><span class="line">   index index.jsp;</span><br><span class="line">   proxy_pass http:&#x2F;&#x2F;192.168.222.128:8080;#转向tomcat处理</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$ #设定访问静态文件直接读取不经过tomcat</span><br><span class="line">&#123;</span><br><span class="line">   expires      30d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location ~ .*\.(js|css)?$</span><br><span class="line">&#123;</span><br><span class="line">   expires      1h;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><h2 id="gzip"><a href="#gzip" class="headerlink" title="gzip"></a><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/e0ff1e275e7f">gzip</a></h2><p>gzip最佳配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gzip on; #开启gzip压缩输出</span><br><span class="line">gzip_min_length 1k;    #最小压缩文件大小</span><br><span class="line">gzip_buffers 4 16k;    #压缩缓冲区</span><br><span class="line">gzip_http_version 1.0;    #识别http协议的版本,早起浏览器可能不支持gzip自解压,用  户会看到乱码（默认1.1，前端如果是squid2.5请使用1.0）</span><br><span class="line">gzip_comp_level 5;    #gzip压缩比（1~9），越小压缩效果越差，但是越大处理越慢，所以一般取中间值;</span><br><span class="line">gzip_types text&#x2F;plain application&#x2F;x-javascript text&#x2F;css application&#x2F;xml application&#x2F;json;    #压缩类型，默认就已经包含&#39;text&#x2F;html&#39;，所以下面就不用再写了，写上去也不会有问题，但是会有一个warn。</span><br><span class="line">gzip_vary on;           #启用应答头&quot;Vary: Accept-Encoding&quot;</span><br><span class="line">gzip_disable &quot;MSIE [1-6]\.&quot;;    #ie6以下就不启用gzip</span><br><span class="line">gzip_proxied off;             #Nginx做为反向代理时启用,</span><br></pre></td></tr></table></figure>

<h2 id="静态资源缓存设置"><a href="#静态资源缓存设置" class="headerlink" title="静态资源缓存设置"></a>静态资源缓存设置</h2><p>Nginx 缓存，可以在一定程度上，减少源服务器的处理请求压力。因为静态文件（比如css，js， 图片）中，很多都是不经常更新的。Nginx 使用proxy_cache 将用户的请求缓存到本地一个目录。下一个相同请求可以直接调取缓存文件，就不用去请求服务器了。利用expires指令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">expires 3d;　　&#x2F;&#x2F;表示缓存3天</span><br><span class="line">expires 3h;　　&#x2F;&#x2F;表示缓存3小时</span><br><span class="line">expires max;　　&#x2F;&#x2F;表示缓存10年</span><br><span class="line">expires -1;　　&#x2F;&#x2F;表示永远过期。</span><br></pre></td></tr></table></figure>

<p> #图片缓存时间设置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> location ~ .*.(gif|jpg|jpeg|png|bmp|swf)$</span><br><span class="line">&#123;</span><br><span class="line">    expires 10d;</span><br><span class="line">&#125;</span><br><span class="line">#JS和CSS缓存时间设置</span><br><span class="line">location ~ .*.(js|css)?$</span><br><span class="line">&#123;</span><br><span class="line">    expires 1h;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果不想让代理或浏览器缓存，加no-cache参数：add_header Cache-Control no-cache; ，这样浏览器F5刷新时，返回的就是http 200，而不是http 304</p>
<h2 id="include指令"><a href="#include指令" class="headerlink" title="include指令"></a><a target="_blank" rel="noopener" href="https://akuma.github.io/2013/11/02/%E4%BD%BF%E7%94%A8-include-%E6%8C%87%E4%BB%A4%E7%AE%80%E5%8C%96-Nginx-%E9%85%8D%E7%BD%AE/">include指令</a></h2><p>使用 include 指令简化 Nginx 配置。假如有多个虚拟主机，配在同一个配置文件中就会显得杂乱无章，因此可以将不同的虚拟主机的配置，放入到不同的配置文件中，通过include引入，达到简化配置、便于管理的目的。当然一些其他的配置项均可以使用include来引入。</p>
<h2 id="ip限制"><a href="#ip限制" class="headerlink" title="ip限制"></a>ip限制</h2><p>封IP段比如从 192.0.0.1到192.0.0.254的命令是：deny 192.0.0.0/24 这其实就是把 192.0.0.x这整个C端屏蔽了。还有一种方法，在 Nginx 的conf目录下面新建配置文件为blocksip.conf：输入要屏蔽的地址deny 24.112.16.30; 保存一下。在 Nginx 的配置文件 nginx.conf 中加入：include blocksip.conf;</p>
<p>重启一下 Nginx 的服务：service nginx reload 就可以生效了。<br>blocksip.conf:的格式还有许多种，可以配置只允许的IP访问或者IP段访问：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># block all ips</span><br><span class="line">deny all;</span><br><span class="line"># allow all ips</span><br><span class="line">allow all;</span><br></pre></td></tr></table></figure>

<p>如果你想实现这样的应用，除了几个IP外，其他全部拒绝，在ip.balcklist中这样写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">allow 1.1.1.1;</span><br><span class="line">allow 1.1.1.2;</span><br><span class="line">deny all;</span><br></pre></td></tr></table></figure>

<p>ip限制除了应用于整个Nginx的访问，还可以单独给某个或者某几个应用去设置。</p>
<h2 id="https"><a href="#https" class="headerlink" title="https"></a><a target="_blank" rel="noopener" href="https://ths.js.org/2020/11/12/%E6%B5%85%E8%B0%88HTTPS/">https</a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen       443 ssl;                 #监听的端口</span><br><span class="line">        server_name  127.0.0.1;      #域名、或者ip</span><br><span class="line"></span><br><span class="line">        ssl_certificate      cert&#x2F;2974467.pem;     #证书路径</span><br><span class="line">        ssl_certificate_key  cert&#x2F;2974467.key;    #key路径</span><br><span class="line"></span><br><span class="line">        ssl_session_cache    shared:SSL:1m;     #储存SSL会话的缓存类型和大小</span><br><span class="line">        ssl_session_timeout  5m;                      #会话过期时间</span><br><span class="line"></span><br><span class="line">        ssl_ciphers  HIGH:!aNULL:!MD5;     #为建立安全连接，服务器所允许的密码格式表</span><br><span class="line">        ssl_prefer_server_ciphers  on;  #依赖SSLv3和TLSv1协议的服务器密码将优先于客户端密码</span><br><span class="line"></span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">            proxy_pass http:&#x2F;&#x2F;127.0.0.1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="安全配置"><a href="#安全配置" class="headerlink" title="安全配置"></a><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/25398b28b816">安全配置</a></h2><p>1、 隐藏 Nginx 版本号<br>    在 http 或者 server下添加这个指令  server_tokens off;   隐藏 Nginx 版本号。经常会有针对某个版本的 Nginx 安全漏洞出现，隐藏Nginx 版本号就成了主要的安全优化手段之一，当然最重要的是及时升级修复漏洞。<br>2、 开启 https<br>     参照上边部分<br>3、 开启黑、白名单配置<br>     通过上边限制 ip 和允许指定 ip 的手段。<br>4、 账号认证<br>      这个就需要借助 Nginx 的 ngx_http_auth_basic_module 模块<br>5、消除目录浏览漏洞<br>       Nginx 默认不允许目录浏览，请检查目录浏览的相关配置，确保没有目录浏览漏洞：检查各个配置文件，确保 autoindex 的配置为 off。</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>Nginx入门</p><p><a href="https://ths-fe.github.io/2020/11/19/nginx%E5%85%A5%E9%97%A8/">https://ths-fe.github.io/2020/11/19/nginx%E5%85%A5%E9%97%A8/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>恋上南山</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2020-11-19</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2020-11-19</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="" rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=5ea1492221690600121bcf3a&amp;product=inline-share-buttons&amp;cms=sop" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/img/alipayqr.jpg" alt="支付宝"></span></a><a class="button donate" href="https://www.buymeacoffee.com/zapzqc?new=1" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>送我杯咖啡</span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/img/wechatqr.jpg" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/12/05/CSS%E5%8F%98%E9%87%8F%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">CSS变量的基本用法</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/11/12/%E6%B5%85%E8%B0%88HTTPS/"><span class="level-item">浅谈HTTPS</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div class="content" id="valine-thread"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script><script>new Valine({
            el: '#valine-thread' ,
            appId: "4o5OfjCIGaSyqIwg7jop80Ge-gzGzoHsz",
            appKey: "Rj9jcPLhW8WgWd6bDmXGmKaA",
            placeholder: "欢迎评论交流",
            avatar: "mm",
            
            meta: ["nick","mail","link"],
            pageSize: 10,
            lang: "zh-CN",
            
            highlight: true,
            
            
            
            
            
            requiredFields: [],
        });</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#概念（背景、F5）"><span class="level-left"><span class="level-item">概念（背景、F5）</span></span></a></li><li><a class="level is-mobile" href="#配置文件"><span class="level-left"><span class="level-item">配置文件</span></span></a></li><li><a class="level is-mobile" href="#常用命令"><span class="level-left"><span class="level-item">常用命令</span></span></a></li><li><a class="level is-mobile" href="#功能（前端开发需要掌握）"><span class="level-left"><span class="level-item">功能（前端开发需要掌握）</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#静态资源发布"><span class="level-left"><span class="level-item">静态资源发布</span></span></a></li><li><a class="level is-mobile" href="#反向代理"><span class="level-left"><span class="level-item">反向代理</span></span></a></li><li><a class="level is-mobile" href="#负载均衡"><span class="level-left"><span class="level-item">负载均衡</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#upstream指令"><span class="level-left"><span class="level-item">upstream指令</span></span></a></li><li><a class="level is-mobile" href="#分配方式"><span class="level-left"><span class="level-item">分配方式</span></span></a></li></ul></li><li><a class="level is-mobile" href="#动静分离"><span class="level-left"><span class="level-item">动静分离</span></span></a></li></ul></li><li><a class="level is-mobile" href="#其他"><span class="level-left"><span class="level-item">其他</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#gzip"><span class="level-left"><span class="level-item">gzip</span></span></a></li><li><a class="level is-mobile" href="#静态资源缓存设置"><span class="level-left"><span class="level-item">静态资源缓存设置</span></span></a></li><li><a class="level is-mobile" href="#include指令"><span class="level-left"><span class="level-item">include指令</span></span></a></li><li><a class="level is-mobile" href="#ip限制"><span class="level-left"><span class="level-item">ip限制</span></span></a></li><li><a class="level is-mobile" href="#https"><span class="level-left"><span class="level-item">https</span></span></a></li><li><a class="level is-mobile" href="#安全配置"><span class="level-left"><span class="level-item">安全配置</span></span></a></li></ul></li></ul></div></div><style>.menu-list > li > a.is-active + .menu-list { display: block; }.menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="adsense"><div class="card-content"><div class="menu"><h3 class="menu-label"> </h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6826040978803389" data-ad-slot="1033672070" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/ths.png" alt="思路大前端团队" height="28"></a><p class="is-size-7"><span>&copy; 2020 恋上南山</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" async></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>